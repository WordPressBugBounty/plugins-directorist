!function(){"use strict";function e(e,a){e=".directorist-dom-data-"+e,a||(a=document);var i=a.querySelector(e);if(!i||!i.dataset.value)return{};var l=directorist&&directorist.script_debugging&&"1"==directorist.script_debugging;try{var t=atob(i.dataset.value);return JSON.parse(t)}catch(e){return l&&console.log(i,e),{}}}jQuery.fn.exists=function(){return jQuery(this).length>0};var a=e("atbdp_plupload_params"),i=e("atbdp_params"),l=jQuery;function t(){var t,r,s;a=e("atbdp_plupload_params"),i=e("atbdp_params"),l(".plupload-upload-uic").exists()&&(s=jQuery("#atbdpectory-add-post input[name='ID']").length?jQuery("#atbdpectory-add-post input[name='ID']").val():jQuery("#post input[name='post_ID']").val(),l(".plupload-upload-uic").each(function(e,d){var p=l(this),n=p.attr("id").replace("plupload-upload-ui",""),u=jQuery("#"+n+"upload-error");o(n),(t=JSON.parse(a.base_plupload_config)).browse_button=n+t.browse_button,t.container=n+t.container,jQuery("#"+n+"dropbox").length&&(t.drop_element=n+"dropbox"),t.file_data_name=n+t.file_data_name,t.multipart_params.imgid=n,t.multipart_params.post_id=s,t.max_file_size=l("#"+n+"_file_size").val(),p.hasClass("plupload-upload-uic-multiple")&&(t.multi_selection=!0);var f=jQuery("#"+n+"_allowed_types").val();if(f=f&&""!=f?f:"","post_images"==n&&void 0!==i.atbdp_allowed_img_types&&""!=i.atbdp_allowed_img_types&&(f=i.atbdp_allowed_img_types),f&&""!=f){var c=void 0!==i.txt_all_files&&""!=i.txt_all_files?i.txt_all_files:"Allowed files";t.filters=[{title:c,extensions:f}]}var v=new plupload.Uploader(t);v.bind("Init",function(e,a){if(v.features.dragdrop){var i=jQuery("#"+n+"dropbox");i.on("dragenter",function(e){i.addClass("dragover")}),i.on("dragleave",function(e){i.removeClass("dragover")}),i.on("drop",function(){i.removeClass("dragover")})}}),v.init(),v.bind("Error",function(e,a){var t;if(u.addClass("upload-error"),-600==a.code)t=(t=void 0!==i.err_max_file_size&&""!=i.err_max_file_size?i.err_max_file_size:"File size error : You tried to upload a file over %s").replace("%s",l("#"+n+"_file_size").val());else if(-601==a.code)if(t=void 0!==i.err_file_type&&""!=i.err_file_type?i.err_file_type:"File type error. Allowed file types: %s","post_images"==n){var r=""!=f?"."+f.replace(/,/g,", ."):"*";t=t.replace("%s",r)}else t=t.replace("%s",jQuery("#"+n+"_allowed_types").attr("data-exts"));else t=a.message;u.html(t)}),v.bind("FilesAdded",function(e,a){var t=parseInt(jQuery("#"+n+"totImg").val()),o=parseInt(jQuery("#"+n+"image_limit").val());if(u.html("").removeClass("upload-error"),o&&p.hasClass("plupload-upload-uic-multiple")&&o>0){if(t>=o&&o>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return r=(r=void 0!==i.err_file_upload_limit&&""!=i.err_file_upload_limit?i.err_file_upload_limit:"You have reached your upload limit of %s files.").replace("%s",o),u.addClass("upload-error").html(r),!1}if(e.files.length>o&&o>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return r=(r=void 0!==i.err_pkg_upload_limit&&""!=i.err_pkg_upload_limit?i.err_pkg_upload_limit:"You may only upload %s files with this package, please try again.").replace("%s",o),u.addClass("upload-error").html(r),!1}}l.each(a,function(e,a){p.find(".filelist").append('<div class="file" id="'+a.id+'"><b>'+a.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(a.size)+') <div class="fileprogress"></div></div>')}),e.refresh(),e.start()}),v.bind("UploadProgress",function(e,a){l("#"+a.id+" .fileprogress").width(a.percent+"%"),l("#"+a.id+" span").html(plupload.formatSize(parseInt(a.size*a.percent/100)))});var m=0,_=new Array;v.bind("FileUploaded",function(e,a,i){if((i=JSON.parse(i.response)).success){var t=parseInt(jQuery("#"+n+"totImg").val());if(_[m]=e,m++,l("#"+a.id).fadeOut(),p.hasClass("plupload-upload-uic-multiple")){t++,jQuery("#"+n+"totImg").val(t);var r=l.trim(l("#"+n,l("#"+n+"plupload-upload-ui").parent()).val());r=r?r+"::"+i.data:i.data,l("#"+n,l("#"+n+"plupload-upload-ui").parent()).val(r)}else l("#"+n,l("#"+n+"plupload-upload-ui").parent()).val(i.data+"");o(n)}else u.addClass("upload-error").html(i.data)}),Error}))}function r(e){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,function(e){return a[e]})}function o(e){var a=parseInt(jQuery("#"+e+"totImg").val()),l=(parseInt(jQuery("#"+e+"image_limit").val()),jQuery),t=l("#"+e+"plupload-thumbs");t.html("");var s=l("#"+e,l("#"+e+"plupload-upload-ui").parent()).val();if(void 0!==i.action_remove&&""!=i.action_remove&&i.action_remove,s){for(var d=s.split("::"),p=0;p<d.length;p++)if(d[p]&&"null"!=d[p]){var n=d[p].split("|"),u=n[0],f=n[1],c=n[2],v=n[3],m="",_="";void 0===f&&(f=""),void 0===c&&(c=""),void 0===v&&(v=""),c=r(c),v=r(v);var g=u.substring(u.lastIndexOf(".")+1);(g=g.split("?").shift())&&(g=g.toLowerCase());var h=u.lastIndexOf("/")+1,b=u.lastIndexOf(".");if(b<h)continue;var y=u.substr(h,b<h?loc.length:b),x="",w="";if("jpg"==g||"jpe"==g||"jpeg"==g||"png"==g||"gif"==g||"bmp"==g||"ico"==g)x='<img class="atbdp-file-info" data-id="'+f+'" data-title="'+c+'" data-caption="'+v+'" data-src="'+u+'" src="'+u+'" alt=""  />',c.trim()&&(m='<span class="atbdp-title-preview">'+c+"</span>"),v.trim()&&(_='<span class="atbdp-caption-preview">'+v+"</span>");else{var j="las la-file";"pdf"==g?j="fas fa-file-pdf":"zip"==g||"tar"==g||"rar"==g||"7z"==g?j="fas fa-file-archive":"doc"==g||"docx"==g||"odt"==g?j="fas fa-file-word":"txt"==g||"text"==g?j="far fa-file-alt":"csv"==g||"ods"==g||"ots"==g||"xls"==g||"xlsx"==g?j="fas fa-file-excel":"avi"==g||"mp4"==g||"mov"==g||"wmv"==g||"flv"==g||"mkv"==g?j="fas fa-file-video":"mp3"==g||"wav"==g||"ogg"==g||"m4a"==g||"flac"==g?j="fas fa-file-audio":"ppt"==g||"pptx"==g?j="fas fa-file-powerpoint":"xps"==g&&(j="fas fa-file-alt");var Q="",I="";"undefined"!=typeof directorist&&directorist.assets_url&&(I=-1!==j.indexOf("fa-file-pdf")?"font-awesome/svgs/solid/file-pdf.svg":-1!==j.indexOf("fa-file-archive")?"font-awesome/svgs/solid/file-archive.svg":-1!==j.indexOf("fa-file-word")?"font-awesome/svgs/solid/file-word.svg":-1!==j.indexOf("fa-file-alt")?"font-awesome/svgs/regular/file-alt.svg":-1!==j.indexOf("fa-file-excel")?"font-awesome/svgs/solid/file-excel.svg":-1!==j.indexOf("fa-file-video")?"font-awesome/svgs/solid/file-video.svg":-1!==j.indexOf("fa-file-audio")?"font-awesome/svgs/solid/file-audio.svg":-1!==j.indexOf("fa-file-powerpoint")?"font-awesome/svgs/solid/file-powerpoint.svg":"font-awesome/svgs/regular/file.svg",Q=directorist.assets_url+"icons/"+I);var C;C=Q&&"undefined"!=typeof directorist&&directorist.icon_markup?directorist.icon_markup.replace("##URL##",Q).replace("##CLASS##","atbdp-file-icon"):Q?'<i class="directorist-icon-mask atbdp-file-icon" aria-hidden="true" style="--directorist-icon: url('+Q+')"></i>':'<i class="directorist-icon-mask atbdp-file-icon" aria-hidden="true"></i>',w="file-thumb",x='<div class="atbdp-file-wrapper atbdp-file-info" title="'+r(y)+'" data-id="'+f+'" data-title="'+c+'" data-caption="'+v+'" data-src="'+u+'">'+C+'<span class="atbdp-file-name">'+r(y)+"</span></div>"}var k=directorist.assets_url+"icons/font-awesome/svgs/solid/trash-alt.svg",O=directorist.icon_markup.replace("##URL##",k).replace("##CLASS##",""),z=l('<div class="thumb '+w+'" id="thumb'+e+p+'">'+m+x+_+'<div class="atbdp-thumb-actions"><span class="thumbremovelink" id="thumbremovelink'+e+p+'">'+O+"</span></div></div>");t.append(z),z.find(".thumbremovelink").click(function(){jQuery("#"+e+"plupload-upload-ui").hasClass("plupload-upload-uic-multiple")&&(a--,jQuery("#"+e+"totImg").val(a)),jQuery("#"+e+"upload-error").html(""),jQuery("#"+e+"upload-error").removeClass("upload-error");var i=l(this).attr("id").replace("thumbremovelink"+e,"");i=parseInt(i);var t=[];s=l("#"+e,l("#"+e+"plupload-upload-ui").parent()).val(),d=s.split("::");for(var r=0;r<d.length;r++)r!=i&&(t[t.length]=d[r]);return l("#"+e,l("#"+e+"plupload-upload-ui").parent()).val(t.join("::")),o(e),!1})}d.length>1&&(t.sortable({update:function(a,i){var r=[];t.find(".atbdp-file-info").each(function(){r[r.length]=l(this).data("src")+"|"+l(this).data("id")+"|"+l(this).data("title")+"|"+l(this).data("caption"),l("#"+e,l("#"+e+"plupload-upload-ui").parent()).val(r.join("::")),o(e)})}}),t.disableSelection());var S=[];t.find(".atbdp-file-info").each(function(){S[S.length]=l(this).data("src")+"|"+l(this).data("id")+"|"+l(this).data("title")+"|"+l(this).data("caption"),l("#"+e,l("#"+e+"plupload-upload-ui").parent()).val(S.join("::"))})}}a&&(jQuery(document).ready(t),window.addEventListener("directorist-reload-plupload",t))}();